<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>ARTAMEDO - Artırılmış Gerçeklik Eğitim Oyunu</title>
  <link rel="stylesheet" href="styles.css?v=20251130q">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- Tam Ekran Butonu -->
  <button id="fullscreen-btn" class="fullscreen-btn" title="Tam Ekran">
    <i data-lucide="maximize" class="fullscreen-icon"></i>
  </button>

  <div class="container">
    <!-- Ana Menü -->
    <div id="main-menu" class="screen active">
      <div class="logo-container">
        <i data-lucide="zap" class="logo-icon-svg"></i>
        <h1 class="game-title">ARTAMEDO</h1>
        <p class="game-subtitle">Artırılmış Gerçeklik Eğitim Oyunu</p>
      </div>
      
      <div class="menu-card">
        <h2 class="section-title">Oyuncu Sayısı Seç</h2>
        <div class="player-selector">
          <button class="player-btn" data-count="1">1</button>
          <button class="player-btn" data-count="2">2</button>
          <button class="player-btn" data-count="3">3</button>
          <button class="player-btn" data-count="4">4</button>
          <button class="player-btn" data-count="5">5</button>
          <button class="player-btn" data-count="6">6</button>
        </div>
        
        <div id="player-names" class="player-names hidden">
          <!-- Dinamik olarak eklenecek -->
        </div>
        
        <div id="turn-order-display" class="turn-order-display hidden">
          <h3 class="turn-order-title">Oyun Sırası</h3>
          <div id="turn-order-list" class="turn-order-list"></div>
          <button id="confirm-start-btn" class="btn-primary" style="margin-top: 20px;">
            <i data-lucide="play" class="btn-icon-svg"></i>
            Oyuna Başla
          </button>
        </div>
        
        <button id="start-game-btn" class="btn-primary hidden">
          <i data-lucide="shuffle" class="btn-icon-svg"></i>
          Sıralamayı Belirle
        </button>
      </div>
      
      <button id="open-rules-btn" class="btn-secondary" style="margin-top: 14px;">
        <i data-lucide="book" class="btn-icon-svg"></i> Kurallar
      </button>
      
      <a href="/admin" class="admin-link">
        <i data-lucide="settings" class="inline-icon"></i> Yönetici Paneli
      </a>
    </div>

    <!-- Oyun Ekranı -->
    <div id="game-screen" class="screen">
      <div class="game-header">
        <div class="player-badge" id="current-player-badge">
          OYUNCU 1
        </div>
      </div>
      
      <!-- QR Scanner -->
      <div class="qr-scanner-container" id="qr-container">
        <div class="scanner-frame">
          <div id="qr-reader"></div>
        </div>
        <p class="scanner-text">QR Kodu Tara</p>
        <button id="manual-qr-btn" class="btn-secondary">
          Manuel QR Girişi
        </button>
      </div>
      
      <!-- Soru Kartı with Progress Border -->
      <div id="question-wrapper" class="question-wrapper hidden">
        <div class="progress-border" id="score-display">
          <!-- Dinamik ilerleme çubuğu -->
        </div>
        <div id="question-card" class="question-card">
          <!-- Dinamik soru içeriği -->
        </div>
      </div>
      
      <!-- Sonuç Göstergesi -->
      <div id="result-indicator" class="result-indicator hidden">
        <!-- Doğru/Yanlış göstergesi -->
      </div>
    </div>

    <!-- Sonuç Ekranı -->
    <div id="results-screen" class="screen">
      <div class="results-container">
        <h1 class="results-title">OYUN BİTTİ!</h1>
        <div id="final-scores" class="final-scores">
          <!-- Dinamik skorlar -->
        </div>
        <button id="play-again-btn" class="btn-primary">
          <i data-lucide="rotate-ccw" class="btn-icon-svg"></i>
          Tekrar Oyna
        </button>
      </div>
    </div>

    <!-- Manuel QR Girişi Modal -->
    <div id="manual-qr-modal" class="modal hidden">
      <div class="modal-content">
        <h3>QR Kodu Girin</h3>
        <input type="text" id="manual-qr-input" placeholder="Örn: 1, 2, 3..." autocomplete="off" data-lpignore="true" data-form-type="other">
        <div class="modal-buttons">
          <button id="submit-qr-btn" class="btn-primary">Tamam</button>
          <button id="cancel-qr-btn" class="btn-secondary">İptal</button>
        </div>
      </div>
    </div>

    <!-- QR Bulunamadı Uyarı Modal -->
    <div id="qr-not-found-modal" class="modal hidden">
      <div class="modal-content warning-modal">
        <div class="warning-icon">
          <i data-lucide="alert-triangle"></i>
        </div>
        <h3>QR Kod Bulunamadı!</h3>
        <p id="qr-not-found-message">Bu QR koda ait soru bulunamadı.</p>
        <div class="modal-buttons">
          <button id="qr-not-found-ok-btn" class="btn-primary">Tamam</button>
        </div>
      </div>
    </div>
    
    <!-- Soru Tipi Seçim Modalı - Slot Makinesi -->
    <div id="type-selection-modal" class="modal hidden">
      <div class="modal-content type-selection-content">
        <div class="player-badge modal-player-badge" id="modal-player-badge">
          OYUNCU
        </div>
        <h3>Soru Tipi Seçimi</h3>
        <p>Butona basarak rastgele soru tipi belirleyin</p>
        
        <div class="slot-machine">
          <div class="slot-window" id="slot-window">
            <div class="slot-reel" id="slot-reel">
              <!-- Dinamik olarak doldurulacak -->
            </div>
          </div>
        </div>
        
        <div class="type-selection-buttons">
          <button id="spin-slot-btn" class="btn-primary spin-btn">
            <i data-lucide="zap" class="btn-icon-svg"></i>
            Çevir!
          </button>
        </div>
        
        <div id="confirm-type-section" class="hidden">
          <button id="confirm-type-btn" class="btn-primary">
            <i data-lucide="qr-code" class="btn-icon-svg"></i>
            QR Kod Tara
          </button>
        </div>
        
        <button class="btn-secondary close-modal-btn" onclick="hideTypeSelectionModal()">
          İptal
        </button>
      </div>
    </div>

    <!-- Kurallar Modal -->
    <div id="rules-modal" class="modal hidden">
      <div class="modal-content rules-modal-content">
        <div class="rules-header">
          <h3><i data-lucide="book-open"></i> Oyun Kuralları</h3>
          <button id="rules-x-btn" class="rules-close-x" aria-label="Kapat">&times;</button>
        </div>
        <div class="rules-body">
          <p class="rules-intro">ARTAMEDO; dijital uygulama ile fiziksel tahtayı entegre oynatan, adım ilerlemeli bir bilgi ve uygulama oyunudur.</p>

          <h4>Özet</h4>
          <ul>
            <li>Oyuncu sayısı: 1–6</li>
            <li>Hedef: Piyonu hedef adımına ilk ulaştırmak</li>
            <li>Entegrasyon: Uygulama soru, süre ve puanı yönetir</li>
          </ul>

          <h4>Kurulum</h4>
          <ul>
            <li>Uygulamada oyun oluşturun, oyuncu adları ve renkleri seçin; rastgele sıra belirlenir.</li>
            <li>Fiziksel tahtada tüm piyonlar Başlangıç’a yerleştirilir.</li>
          </ul>

          <h4>Tur Akışı</h4>
          <ol>
            <li>Aktif oyuncu QR kodu okutarak soruyu açar.</li>
            <li>Süreli sorularda sayaç başlar; Uygulama tipi sorularda süre otomatik başlamaz, “Süreyi Başlat” ile başlatılır.</li>
            <li>Oyuncu cevaplar/ görevi tamamlar; doğruluk uygulamada gösterilir. Soruya göre kaç adım ilerleyeceği belirlenir.</li>
            <li>“Sonraki Oyuncu” ile sıra devam eder.</li>
          </ol>

          <h4>Süre</h4>
          <ul>
            <li>10 sn kala uyarı, 5 sn kala kritik renk gösterilir.</li>
            <li>Süre biterse soru yanlış sayılır.</li>
          </ul>

          <h4>Puan / İlerleme</h4>
          <ul>
            <li>Varsayılan: Doğru +2 adım, Yanlış −1 adım (0’ın altına düşmez).</li>
            <li>Her soru kendi Doğru + adım, Yanlış − adım değerleriyle bu değiştirebilir.</li>
            <li>Hedef adımına ulaşan oyuncu oyunu kazanır.</li>
          </ul>

          <h4>Soru Tipleri</h4>
          <ul>
            <li>Çoktan Seçmeli</li>
            <li>Doğru/Yanlış</li>
            <li>Boşluk Doldurma</li>
            <li>Eşleştirme</li>
            <li>Sürükle–Bırak</li>
            <li>Kapışma: 2’li veya Hep Birlikte (ilk basan cevaplar)</li>
            <li>Uygulama: Gerçek dünya görevi; süreyi oyuncu başlatır, öğretmen Doğru/Yanlış onaylar.</li>
          </ul>

          <h4>AR ve Bilgi</h4>
          <ul>
            <li>“Bilgi” butonu soruya dair ek açıklama/ görsel/AR içeriği açabilir.</li>
          </ul>
        </div>
        <div class="modal-buttons" style="margin-top: 18px;">
          <button id="rules-close-btn" class="btn-primary">Tamam</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="game.js"></script>
</body>
</html>